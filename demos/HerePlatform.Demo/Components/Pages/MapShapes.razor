@page "/map-shapes"
@rendermode InteractiveServer

<PageTitle>Shapes</PageTitle>

<h3>Shapes Demo</h3>
<p>Declarative shape components â€” Polyline, Circle, and Rectangle as child components of AdvancedHereMap.</p>

<details class="mb-3">
    <summary class="fw-bold" role="button">Usage</summary>
    <pre class="bg-light border rounded p-3 mt-2 mb-0"><code>&lt;AdvancedHereMap Options="@@_mapOptions" Height="500px"&gt;

    &lt;!-- Polyline with styling options --&gt;
    &lt;PolylineComponent Path="@@_polylinePath"
        StrokeColor="#0066FF" LineWidth="4"
        LineCap="round" LineJoin="@@_lineJoin"
        Arrows="@@_showArrows" ZIndex="@@_polylineZIndex"
        OnClick="@@(e =&gt; ...)" /&gt;

    &lt;!-- Dashed polyline --&gt;
    &lt;PolylineComponent Path="@@_dashedPath"
        StrokeColor="#9900CC" LineWidth="3"
        LineDash="@@(new double[] { 10, 6 })"
        LineDashOffset="@@_dashOffset" /&gt;

    &lt;!-- Circle with two-way bound center (draggable) --&gt;
    &lt;CircleComponent
        @@bind-CenterLat="_circleLat" @@bind-CenterLng="_circleLng"
        Radius="@@_circleRadius"
        StrokeColor="#FF0000" FillColor="rgba(255, 0, 0, 0.2)"
        Draggable="true" /&gt;

    &lt;!-- Rectangle with two-way bound corners (draggable) --&gt;
    &lt;RectComponent
        @@bind-Top="_rectTop" @@bind-Left="_rectLeft"
        @@bind-Bottom="_rectBottom" @@bind-Right="_rectRight"
        StrokeColor="#FF9900" FillColor="rgba(255, 153, 0, 0.25)"
        Draggable="true" ZIndex="@@_rectZIndex" /&gt;

&lt;/AdvancedHereMap&gt;

@@code {
    private MapOptions _mapOptions = new()
    {
        Center = new LatLngLiteral(52.52, 13.405),
        Zoom = 13,
        EnableUI = true,
        EnableInteraction = true
    };

    private string _lineJoin = "round";   // round | miter | bevel
    private bool _showArrows;
    private int _polylineZIndex = 0;
    private double _dashOffset;
    private double _circleRadius = 500;
    private int _rectZIndex = 0;

    // Two-way bound shape positions (updated when dragged)
    private double _circleLat = 52.5163, _circleLng = 13.3777;
    private double _rectTop = 52.525, _rectLeft = 13.410;
    private double _rectBottom = 52.515, _rectRight = 13.430;

    private List&lt;LatLngLiteral&gt; _polylinePath = new()
    {
        new(52.5200, 13.3900), new(52.5230, 13.4000),
        new(52.5180, 13.4100), new(52.5210, 13.4200)
    };

    private List&lt;LatLngLiteral&gt; _dashedPath = new()
    {
        new(52.5170, 13.3900), new(52.5190, 13.4050),
        new(52.5150, 13.4150), new(52.5175, 13.4250)
    };
}</code></pre>
</details>

<AdvancedHereMap Options="@_mapOptions" Height="clamp(250px, 50vh, 500px)">
    <PolylineComponent
        Path="@_polylinePath"
        StrokeColor="#0066FF"
        LineWidth="4"
        LineCap="round"
        LineJoin="@_lineJoin"
        Visible="@_showPolyline"
        ZIndex="@_polylineZIndex"
        Arrows="@_showArrows"
        OnClick="@(e => _status = $"Polyline clicked at ({e.Position?.Lat:F4}, {e.Position?.Lng:F4})")" />

    @if (_showDashedPolyline)
    {
        <PolylineComponent
            Path="@_dashedPath"
            StrokeColor="#9900CC"
            LineWidth="3"
            LineDash="@(new double[] { 10, 6 })"
            LineDashOffset="@_dashOffset"
            Visible="true" />
    }

    <CircleComponent
        @bind-CenterLat="_circleLat"
        @bind-CenterLng="_circleLng"
        Radius="@_circleRadius"
        StrokeColor="#FF0000"
        FillColor="rgba(255, 0, 0, 0.2)"
        LineWidth="2"
        Visible="@_showCircle"
        Draggable="@_draggableCircle"
        OnClick="@(e => _status = $"Circle clicked at ({e.Position?.Lat:F4}, {e.Position?.Lng:F4})")" />

    <RectComponent
        @bind-Top="_rectTop"
        @bind-Left="_rectLeft"
        @bind-Bottom="_rectBottom"
        @bind-Right="_rectRight"
        StrokeColor="#FF9900"
        FillColor="rgba(255, 153, 0, 0.25)"
        LineWidth="2"
        Visible="@_showRect"
        Draggable="@_draggableRect"
        ZIndex="@_rectZIndex"
        OnClick="@(e => _status = $"Rect clicked at ({e.Position?.Lat:F4}, {e.Position?.Lng:F4})")" />
</AdvancedHereMap>

<div class="mt-3">
    <div class="btn-group me-3" role="group">
        <button class="btn btn-outline-primary @(_showPolyline ? "active" : "")" @onclick="@(() => _showPolyline = !_showPolyline)">
            Polyline
        </button>
        <button class="btn btn-outline-danger @(_showCircle ? "active" : "")" @onclick="@(() => _showCircle = !_showCircle)">
            Circle
        </button>
        <button class="btn btn-outline-warning @(_showRect ? "active" : "")" @onclick="@(() => _showRect = !_showRect)">
            Rectangle
        </button>
    </div>

    <label class="ms-3">
        Circle Radius: <input type="range" min="100" max="2000" step="50" @bind="_circleRadius" @bind:event="oninput" @bind:culture="@CultureInfo.InvariantCulture" /> @_circleRadius m
    </label>
</div>

<div class="mt-2 d-flex gap-3 flex-wrap align-items-center">
    <div>
        <label>LineJoin:</label>
        <div class="btn-group btn-group-sm ms-1">
            <button class="btn @(_lineJoin == "round" ? "btn-primary" : "btn-outline-primary")" @onclick="@(() => _lineJoin = "round")">round</button>
            <button class="btn @(_lineJoin == "miter" ? "btn-primary" : "btn-outline-primary")" @onclick="@(() => _lineJoin = "miter")">miter</button>
            <button class="btn @(_lineJoin == "bevel" ? "btn-primary" : "btn-outline-primary")" @onclick="@(() => _lineJoin = "bevel")">bevel</button>
        </div>
    </div>

    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" @bind="_showArrows" />
        <label class="form-check-label">Arrows</label>
    </div>

    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" @bind="_showDashedPolyline" />
        <label class="form-check-label">Dashed Line</label>
    </div>

    <div>
        <label>Dash Offset: @_dashOffset.ToString("F0", CultureInfo.InvariantCulture)</label>
        <input type="range" min="0" max="20" step="1" @bind="_dashOffset" @bind:event="oninput" @bind:culture="@CultureInfo.InvariantCulture" style="max-width:120px;" />
    </div>

    <div>
        <label>Polyline ZIndex: @_polylineZIndex</label>
        <input type="range" min="0" max="10" step="1" @bind="_polylineZIndex" @bind:event="oninput" style="max-width:100px;" />
    </div>

    <div>
        <label>Rect ZIndex: @_rectZIndex</label>
        <input type="range" min="0" max="10" step="1" @bind="_rectZIndex" @bind:event="oninput" style="max-width:100px;" />
    </div>

    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" @bind="_draggableCircle" />
        <label class="form-check-label">Draggable Circle</label>
    </div>

    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" @bind="_draggableRect" />
        <label class="form-check-label">Draggable Rect</label>
    </div>
</div>

@if (_draggableCircle || _draggableRect)
{
    <div class="mt-2 small text-muted">
        <strong>Two-way binding (drag shapes to update):</strong>
        @if (_draggableCircle)
        {
            <span class="ms-2">Circle: (@_circleLat.ToString("F4", CultureInfo.InvariantCulture), @_circleLng.ToString("F4", CultureInfo.InvariantCulture))</span>
        }
        @if (_draggableRect)
        {
            <span class="ms-2">Rect: T=@_rectTop.ToString("F4", CultureInfo.InvariantCulture) L=@_rectLeft.ToString("F4", CultureInfo.InvariantCulture) B=@_rectBottom.ToString("F4", CultureInfo.InvariantCulture) R=@_rectRight.ToString("F4", CultureInfo.InvariantCulture)</span>
        }
    </div>
}

@if (!string.IsNullOrEmpty(_status))
{
    <div class="mt-3 alert alert-info">
        @_status
    </div>
}

@code {
    private MapOptions _mapOptions = new()
    {
        Center = new LatLngLiteral(52.52, 13.405),
        Zoom = 13,
        EnableUI = true,
        EnableInteraction = true
    };

    private bool _showPolyline = true;
    private bool _showCircle = true;
    private bool _showRect = true;
    private double _circleRadius = 500;
    private string? _status;
    private string _lineJoin = "round";
    private bool _showArrows;
    private bool _showDashedPolyline;
    private double _dashOffset;
    private int _polylineZIndex = 0;
    private int _rectZIndex = 0;
    private bool _draggableRect;
    private bool _draggableCircle;
    private double _circleLat = 52.5163;
    private double _circleLng = 13.3777;
    private double _rectTop = 52.525;
    private double _rectLeft = 13.410;
    private double _rectBottom = 52.515;
    private double _rectRight = 13.430;

    private List<LatLngLiteral> _polylinePath = new()
    {
        new(52.5200, 13.3900),
        new(52.5230, 13.4000),
        new(52.5180, 13.4100),
        new(52.5210, 13.4200)
    };

    private List<LatLngLiteral> _dashedPath = new()
    {
        new(52.5170, 13.3900),
        new(52.5190, 13.4050),
        new(52.5150, 13.4150),
        new(52.5175, 13.4250)
    };
}
