@page "/demo/map-groups"

<PageTitle>Groups &amp; DomMarkers</PageTitle>

<h3>Groups, DomMarkers &amp; InfoBubble Demo</h3>
<p>Demonstrates GroupComponent (toggle visibility of a group of objects), DomMarkerComponent (HTML markers), and standalone InfoBubbleComponent.</p>

<details class="mb-3">
    <summary class="fw-bold" role="button">Usage</summary>
    <pre class="bg-light border rounded p-3 mt-2 mb-0"><code>&lt;AdvancedHereMap Options="@@_mapOptions" Height="500px"&gt;

    &lt;!-- GroupComponent: toggle visibility of all children at once --&gt;
    &lt;GroupComponent @@ref="_group" Visible="@@_showGroup"&gt;

        &lt;!-- DomMarkerComponent renders custom HTML as a marker --&gt;
        &lt;DomMarkerComponent Lat="52.5200" Lng="13.4050"
            Clickable="true"
            OnClick="@@(e =&gt; _status = &amp;quot;Marker A clicked&amp;quot;)"&gt;
            &lt;div style="background:#E74C3C;color:white;
                        padding:4px 8px;border-radius:4px"&gt;
                Custom HTML Marker
            &lt;/div&gt;
        &lt;/DomMarkerComponent&gt;

    &lt;/GroupComponent&gt;

    &lt;!-- Declarative InfoBubble with two-way IsOpen binding --&gt;
    &lt;InfoBubbleComponent Lat="52.5163" Lng="13.3777"
        @@bind-IsOpen="_showInfoBubble" AutoPan="@@_autoPan"&gt;
        &lt;div&gt;
            &lt;strong&gt;Victory Column&lt;/strong&gt;&lt;br /&gt;
            A monument in Berlin, Germany.
        &lt;/div&gt;
    &lt;/InfoBubbleComponent&gt;

&lt;/AdvancedHereMap&gt;

@@code {
    private GroupComponent? _group;
    private bool _showGroup = true;
    private bool _showInfoBubble = false;
    private bool _autoPan = true;
    private string? _status;

    private MapOptions _mapOptions = new()
    {
        Center = new LatLngLiteral(52.52, 13.405),
        Zoom = 14,
        EnableUI = true,
        EnableInteraction = true
    };

    // Get the bounding box of all objects in the group
    private async Task GetGroupBounds()
    {
        if (_group == null) return;
        var bounds = await _group.GetBoundsAsync();
        // bounds.Top, bounds.Left, bounds.Bottom, bounds.Right
    }
}</code></pre>
</details>

<AdvancedHereMap Options="@_mapOptions" Height="clamp(250px, 50vh, 500px)">
    <GroupComponent @ref="_group" Visible="@_showGroup">
        <DomMarkerComponent Lat="52.5200" Lng="13.4050"
            Clickable="true"
            OnClick="@(e => _status = "DomMarker A clicked")">
            <div style="background:#E74C3C;color:white;padding:4px 8px;border-radius:4px;font-size:12px;white-space:nowrap;">
                Marker A
            </div>
        </DomMarkerComponent>

        <DomMarkerComponent Lat="52.5230" Lng="13.4100"
            Clickable="true"
            OnClick="@(e => _status = "DomMarker B clicked")">
            <div style="background:#3498DB;color:white;padding:4px 8px;border-radius:4px;font-size:12px;white-space:nowrap;">
                Marker B
            </div>
        </DomMarkerComponent>

        <DomMarkerComponent Lat="52.5180" Lng="13.3950"
            Clickable="true"
            OnClick="@(e => _status = "DomMarker C clicked")">
            <div style="background:#2ECC71;color:white;padding:4px 8px;border-radius:4px;font-size:12px;white-space:nowrap;">
                Marker C
            </div>
        </DomMarkerComponent>
    </GroupComponent>

    <InfoBubbleComponent Lat="52.5163" Lng="13.3777" @bind-IsOpen="_showInfoBubble" AutoPan="@_autoPan">
        <div>
            <strong>Victory Column</strong><br />
            The Berlin Victory Column is a monument in Berlin, Germany.
        </div>
    </InfoBubbleComponent>
</AdvancedHereMap>

<div class="mt-3">
    <button class="btn @(_showGroup ? "btn-primary" : "btn-outline-primary")" @onclick="@(() => _showGroup = !_showGroup)">
        Toggle Group (@(_showGroup ? "visible" : "hidden"))
    </button>
    <button class="btn @(_showInfoBubble ? "btn-info" : "btn-outline-info") ms-2" @onclick="@(() => _showInfoBubble = !_showInfoBubble)">
        Toggle InfoBubble (@(_showInfoBubble ? "open" : "closed"))
    </button>
    <div class="form-check form-switch ms-3 d-inline-block">
        <input class="form-check-input" type="checkbox" @bind="_autoPan" />
        <label class="form-check-label">AutoPan</label>
    </div>
    <button class="btn btn-outline-secondary btn-sm ms-2" @onclick="GetGroupBounds">
        Get Group Bounds
    </button>
</div>

@if (!string.IsNullOrEmpty(_status))
{
    <div class="mt-3 alert alert-info">@_status</div>
}

@code {
    private GroupComponent? _group;

    private MapOptions _mapOptions = new()
    {
        Center = new LatLngLiteral(52.52, 13.405),
        Zoom = 14,
        EnableUI = true,
        EnableInteraction = true
    };

    private bool _showGroup = true;
    private bool _showInfoBubble = false;
    private bool _autoPan = true;
    private string? _status;

    private async Task GetGroupBounds()
    {
        if (_group == null) return;
        var bounds = await _group.GetBoundsAsync();
        if (bounds != null)
        {
            _status = $"Group bounds: Top={bounds.Top:F4}, Left={bounds.Left:F4}, Bottom={bounds.Bottom:F4}, Right={bounds.Right:F4}";
        }
        else
        {
            _status = "No bounds (group empty or not ready).";
        }
        StateHasChanged();
    }
}
