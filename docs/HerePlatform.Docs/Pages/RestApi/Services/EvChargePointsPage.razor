@page "/rest-api/ev-charge-points"
@inject IEvChargePointsService EvChargePointsService
@inject IRestApiDocService DocService

<PageTitle>EV Charge Points — HerePlatform.NET Docs</PageTitle>

<div class="doc-content">
    <h1>IEvChargePointsService</h1>
    @if (_apiName is not null)
    {
        <span class="badge bg-info text-dark mb-2">@_apiName @_apiVersion</span>
    }
    <p class="lead">@_serviceDescription</p>
    <ApiKeyWarning />

    <h2>SearchStationsAsync</h2>
    <p>@_methodDescription</p>
    <ParamTable Parameters="@_params" />

    <h5>Example Response (Success)</h5>
    <CodeBlock Language="json" Code="@_successExample" />

    <TryItPanel TResult="EvChargePointsResult" OnExecute="ExecuteSearch">
        <FormContent>
            <div class="row g-2">
                <div class="col-md-3">
                    <label class="form-label">Latitude</label>
                    <input type="number" step="any" class="form-control form-control-sm" @bind="_lat" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Longitude</label>
                    <input type="number" step="any" class="form-control form-control-sm" @bind="_lng" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Radius (m)</label>
                    <input type="number" class="form-control form-control-sm" @bind="_radius" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Max Results</label>
                    <input type="number" class="form-control form-control-sm" @bind="_maxResults" min="1" max="100" />
                </div>
            </div>
            <div class="row g-2 mt-1">
                <div class="col-12">
                    <label class="form-label">Connector Types</label>
                    <div class="d-flex gap-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ctType2" @bind="_type2" />
                            <label class="form-check-label" for="ctType2">Type 2</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ctCcs2" @bind="_ccsCombo2" />
                            <label class="form-check-label" for="ctCcs2">CCS Combo 2</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ctChademo" @bind="_chademo" />
                            <label class="form-check-label" for="ctChademo">CHAdeMO</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ctTesla" @bind="_tesla" />
                            <label class="form-check-label" for="ctTesla">Tesla</label>
                        </div>
                    </div>
                </div>
            </div>
        </FormContent>
    </TryItPanel>
</div>

@code {
    private double _lat = 52.5308, _lng = 13.3847;
    private double _radius = 5000;
    private int _maxResults = 20;
    private bool _type2, _ccsCombo2, _chademo, _tesla;

    private Task<EvChargePointsResult> ExecuteSearch()
    {
        var connectors = new List<ConnectorType>();
        if (_type2) connectors.Add(ConnectorType.Type2);
        if (_ccsCombo2) connectors.Add(ConnectorType.CcsCombo2);
        if (_chademo) connectors.Add(ConnectorType.Chademo);
        if (_tesla) connectors.Add(ConnectorType.TeslaSupercharger);

        return EvChargePointsService.SearchStationsAsync(new EvChargePointsRequest
        {
            Position = new LatLngLiteral(_lat, _lng),
            Radius = _radius,
            MaxResults = _maxResults,
            ConnectorTypes = connectors.Count > 0 ? connectors : null
        });
    }

    private string _serviceDescription = "";
    private string _methodDescription = "";
    private string? _apiName;
    private string? _apiVersion;
    private List<ParamDoc> _params = [];

    protected override async Task OnInitializedAsync()
    {
        await DocService.InitializeAsync();
        var svc = DocService.GetService(nameof(IEvChargePointsService));
        _serviceDescription = svc?.Description ?? "";
        _apiName = svc?.ApiName;
        _apiVersion = svc?.ApiVersion;
        _methodDescription = DocService.GetMethod(nameof(IEvChargePointsService), nameof(IEvChargePointsService.SearchStationsAsync))?.Description ?? "";
        _params = DocService.GetMethodParams(nameof(IEvChargePointsService), nameof(IEvChargePointsService.SearchStationsAsync));
    }

    private const string _successExample = @"{
  ""stations"": [
    {
      ""poolId"": ""800:48.856600:2.352200"",
      ""address"": ""Friedrichstraße 100, 10117 Berlin"",
      ""position"": { ""lat"": 52.5308, ""lng"": 13.3847 },
      ""totalNumberOfConnectors"": 4,
      ""connectors"": [
        {
          ""supplierName"": ""ChargePoint"",
          ""connectorTypeName"": ""CCS Combo 2"",
          ""maxPowerLevel"": 150.0,
          ""chargeCapacity"": 2,
          ""fixedCable"": true
        }
      ]
    }
  ]
}";
}
