@page "/rest-api/intermodal-routing"
@inject IIntermodalRoutingService IntermodalRoutingService
@inject IRestApiDocService DocService

<PageTitle>Intermodal Routing â€” HerePlatform.NET Docs</PageTitle>

<div class="doc-content">
    <h1>IIntermodalRoutingService</h1>
    @if (_apiName is not null)
    {
        <span class="badge bg-info text-dark mb-2">@_apiName @_apiVersion</span>
    }
    <p class="lead">@_serviceDescription</p>
    <ApiKeyWarning />

    <h2>CalculateRouteAsync</h2>
    <p>@_methodDescription</p>
    <ParamTable Parameters="@_params" />

    <h5>Example Response (Success)</h5>
    <CodeBlock Language="json" Code="@_successExample" />

    <TryItPanel TResult="IntermodalRoutingResult" OnExecute="ExecuteRoute">
        <FormContent>
            <div class="row g-2">
                <div class="col-md-3">
                    <label class="form-label">Origin Lat</label>
                    <input type="number" step="any" class="form-control form-control-sm" @bind="_originLat" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Origin Lng</label>
                    <input type="number" step="any" class="form-control form-control-sm" @bind="_originLng" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Dest Lat</label>
                    <input type="number" step="any" class="form-control form-control-sm" @bind="_destLat" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Dest Lng</label>
                    <input type="number" step="any" class="form-control form-control-sm" @bind="_destLng" />
                </div>
            </div>
            <div class="row g-2 mt-1">
                <div class="col-md-4">
                    <label class="form-label">Depart At</label>
                    <input type="datetime-local" class="form-control form-control-sm" @bind="_departAt" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Alternatives</label>
                    <input type="number" class="form-control form-control-sm" @bind="_alternatives" min="0" max="6" />
                </div>
                <div class="col-md-4">
                    <label class="form-label">Lang</label>
                    <input class="form-control form-control-sm" @bind="_lang" placeholder="de" />
                </div>
            </div>
        </FormContent>
    </TryItPanel>
</div>

@code {
    private double _originLat = 52.5200, _originLng = 13.4050;
    private double _destLat = 52.5400, _destLng = 13.3600;
    private DateTime? _departAt;
    private int _alternatives = 0;
    private string? _lang;

    private Task<IntermodalRoutingResult> ExecuteRoute() =>
        IntermodalRoutingService.CalculateRouteAsync(new IntermodalRoutingRequest
        {
            Origin = new LatLngLiteral(_originLat, _originLng),
            Destination = new LatLngLiteral(_destLat, _destLng),
            DepartAt = _departAt?.ToString("s"),
            Alternatives = _alternatives,
            Lang = string.IsNullOrWhiteSpace(_lang) ? null : _lang
        });

    private string _serviceDescription = "";
    private string _methodDescription = "";
    private string? _apiName;
    private string? _apiVersion;
    private List<ParamDoc> _params = [];

    protected override async Task OnInitializedAsync()
    {
        await DocService.InitializeAsync();
        var svc = DocService.GetService(nameof(IIntermodalRoutingService));
        _serviceDescription = svc?.Description ?? "";
        _apiName = svc?.ApiName;
        _apiVersion = svc?.ApiVersion;
        _methodDescription = DocService.GetMethod(nameof(IIntermodalRoutingService), nameof(IIntermodalRoutingService.CalculateRouteAsync))?.Description ?? "";
        _params = DocService.GetMethodParams(nameof(IIntermodalRoutingService), nameof(IIntermodalRoutingService.CalculateRouteAsync));
    }

    private const string _successExample = @"{
  ""routes"": [
    {
      ""sections"": [
        {
          ""type"": ""pedestrian"",
          ""departure"": { ""name"": ""Start"", ""location"": { ""lat"": 52.52, ""lng"": 13.405 }, ""time"": ""2025-01-15T08:00:00"" },
          ""arrival"": { ""name"": ""U Friedrichstr."", ""location"": { ""lat"": 52.52, ""lng"": 13.39 }, ""time"": ""2025-01-15T08:10:00"" },
          ""travelSummary"": { ""duration"": 600, ""length"": 800 },
          ""transport"": { ""mode"": ""pedestrian"" }
        },
        {
          ""type"": ""transit"",
          ""departure"": { ""name"": ""U Friedrichstr."", ""time"": ""2025-01-15T08:12:00"" },
          ""arrival"": { ""name"": ""U Hauptbahnhof"", ""time"": ""2025-01-15T08:18:00"" },
          ""travelSummary"": { ""duration"": 360, ""length"": 2000 },
          ""transport"": { ""mode"": ""subway"", ""name"": ""U6"", ""shortName"": ""U6"", ""headsign"": ""Alt-Tegel"", ""color"": ""#7B3F98"" }
        },
        {
          ""type"": ""pedestrian"",
          ""departure"": { ""name"": ""U Hauptbahnhof"", ""time"": ""2025-01-15T08:18:00"" },
          ""arrival"": { ""name"": ""Destination"", ""time"": ""2025-01-15T08:25:00"" },
          ""travelSummary"": { ""duration"": 420, ""length"": 500 },
          ""transport"": { ""mode"": ""pedestrian"" }
        }
      ]
    }
  ]
}";
}
