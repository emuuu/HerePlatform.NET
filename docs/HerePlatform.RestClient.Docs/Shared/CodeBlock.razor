@inject IJSRuntime JS

<div class="code-block position-relative">
    <button class="btn btn-sm btn-outline-light copy-btn position-absolute top-0 end-0 m-2"
            @onclick="CopyToClipboard">
        @(_copied ? "Copied!" : "Copy")
    </button>
    <pre class="m-0"><code class="language-@Language" @ref="_codeElement">@Code</code></pre>
</div>

@code {
    [Parameter, EditorRequired] public string Code { get; set; } = "";
    [Parameter] public string Language { get; set; } = "csharp";

    private ElementReference _codeElement;
    private bool _copied;
    private string? _lastCode;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (Code != _lastCode)
        {
            _lastCode = Code;
            try
            {
                await JS.InvokeVoidAsync("BlazorDocs.highlightElement", _codeElement);
            }
            catch (JSDisconnectedException) { }
        }
    }

    private async Task CopyToClipboard()
    {
        try
        {
            await JS.InvokeVoidAsync("BlazorDocs.copyToClipboard", Code);
            _copied = true;
            StateHasChanged();
            await Task.Delay(2000);
            _copied = false;
            StateHasChanged();
        }
        catch (JSDisconnectedException) { }
    }
}
