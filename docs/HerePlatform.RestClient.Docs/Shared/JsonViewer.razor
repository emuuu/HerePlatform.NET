@inject IJSRuntime JS

<div class="code-block position-relative">
    <button class="btn btn-sm btn-outline-light copy-btn position-absolute top-0 end-0 m-2"
            @onclick="CopyToClipboard">
        @(_copied ? "Copied!" : "Copy")
    </button>
    <pre class="m-0" style="max-height: 400px; overflow: auto;"><code class="language-json" @ref="_codeElement">@Json</code></pre>
</div>

@code {
    [Parameter, EditorRequired] public string Json { get; set; } = "";

    private ElementReference _codeElement;
    private bool _copied;
    private string? _lastJson;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (Json != _lastJson)
        {
            _lastJson = Json;
            try
            {
                await JS.InvokeVoidAsync("BlazorDocs.highlightElement", _codeElement);
            }
            catch (JSDisconnectedException) { }
        }
    }

    private async Task CopyToClipboard()
    {
        try
        {
            await JS.InvokeVoidAsync("BlazorDocs.copyToClipboard", Json);
            _copied = true;
            StateHasChanged();
            await Task.Delay(2000);
            _copied = false;
            StateHasChanged();
        }
        catch (JSDisconnectedException) { }
    }
}
